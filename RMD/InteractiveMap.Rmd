---
output: 
  md_document:
    variant: markdown_github
---

```{r r_packages, include=FALSE}
library(leaflet)
```
##Oyster Restoration Project Sensor Map

You can read more about the project here : [ UF Oyster Restoration Project](http://www.wec.ufl.edu/oysterproject/restoration.php)  

These data are provisional raw downloads from instruments and subject to revision following QA/QC procedures.    
Temperature and salinity (estimated from conductivity measures) are recorded hourly using CT sensors at stations 2 and 4-9, and CTD sensors at stations 1 and 3.    
Oyster beds displayed are part of a Lone Cabbage sampling effort, and not representative of all oyster beds in Cedar Key, FL.    
This map is constantly being updated and changed. Gaps in data are caused by either sensor malfunctions, missing sensors, or user error.   

```{r r_uploads,include= FALSE}
library(rgdal)

propreef <- readOGR(dsn=path.expand("T:/Oyster Project/mels_git/mapping/shapefile"), layer = "LC_reef_elements")

oysterbeds1982<- readOGR(dsn= path.expand("T:/Oyster Project/mels_git/mapping/shapefile"), layer="LC_1982")

oysterbeds1995<- readOGR(dsn= path.expand("T:/Oyster Project/mels_git/mapping/shapefile"), layer="LC_1995")

oysterbeds2001<- readOGR(dsn= path.expand("T:/Oyster Project/mels_git/mapping/shapefile"), layer="LC_2001")

oysterbeds2010<- readOGR(dsn= path.expand("T:/Oyster Project/mels_git/mapping/shapefile"), layer="LC_2010")

PRO <- sp::CRS('+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0')
oysterbeds1982p <- sp::spTransform(oysterbeds1982,PRO)
oysterbeds1995p <- sp::spTransform(oysterbeds1995,PRO)
oysterbeds2001p <- sp::spTransform(oysterbeds2001,PRO)
oysterbeds2010p <- sp::spTransform(oysterbeds2010,PRO)


```
```{r oyster_icon, include=FALSE}

divericon <- makeIcon(
  iconUrl = "T:/Oyster Project/mels_git/mapping/icon/diver3.png",
  iconWidth = 12, iconHeight = 65)

staricon <- makeIcon(
  iconUrl = "T:/Oyster Project/mels_git/mapping/icon/star.png",
  iconWidth = 12, iconHeight = 50)

```

```{r r_FWC, include= FALSE, eval=FALSE}
require(sas7bdat)
setwd("C:/Users/melimore86/Desktop/FWC")

hydro2017=read.sas7bdat("ckm_2017_hydrolab.sas7bdat")
physical2017=read.sas7bdat("ckm_2017_physical.sas7bdat")

require(dplyr)
hydrophysical2017 <- left_join(hydro2017, physical2017, by = c('Reference'))

require(reshape)
hydrophysical2017$Reference2 <- substr(hydrophysical2017$Reference, start=4, stop=11)

require(lubridate)
hydrophysical2017$NEWDATE <- lubridate::ymd(hydrophysical2017$Reference2)

lon<-(physical2017$Longitude)
lat<-(physical2017$Latitude)
dffwc2017 <- as.data.frame(cbind(lon,lat))

```

```{r r_map, include=FALSE}
intermap<-leaflet() %>%  addProviderTiles("OpenStreetMap.HOT", group = "OpenStreetMap.HOT") %>% addProviderTiles("Esri.NatGeoWorldMap", group = "Esri.NatGeoWorldMap") %>%
  addProviderTiles("Esri.WorldImagery", group = "Esri WorldImagery")  %>% 
  #addProviderTiles("CartoDB.Positron",group = "CartoDB Positron")%>%  
  addPolygons(data = oysterbeds1982p,stroke = FALSE, fillOpacity = .8, smoothFactor = 0.5, group= "1982 oyster distribution", color= "#33FF00")%>%
  addPolygons(data = oysterbeds1995p,stroke = FALSE, fillOpacity = 0.8, smoothFactor = 0.5, group= "1995 oyster distribution", color= "#3399FF")%>%
  addPolygons(data = oysterbeds2001p,stroke = FALSE, fillOpacity = 0.6, smoothFactor = 0.5, group= "2001 oyster distribution", color= "#9900FF")%>%
   addPolygons(data = oysterbeds2010p,stroke = FALSE, fillOpacity = 0.6, smoothFactor = 0.5, group= "2010 oyster distribution", color= "#FF33CC")%>%
   addPolygons(data = propreef,stroke = FALSE, fillOpacity = 1, smoothFactor = 0.5, group= "Proposed Reef", color="black")%>%
  #addCircleMarkers(data=physical2017,lng=lon,lat=lat,label = ~as.character(Station_1), group="FWC 2017 Sites",color="#009E73")%>%
  setView(-83.10, 29.25, 14) %>%
addMarkers(
    lng = -83.115749973803759, lat = 29.266459979116917,
    label = "Site 1, Serial # V5602",
    labelOptions = labelOptions(noHide = F, direction= "right"),
    popup= '<a href = "http://rpubs.com/melimore86/site1measurements"> Sensor Measurements </a>',icon=divericon) %>%
  addMarkers(
    lng = -83.095912020653486, lat = 29.24560303799808,
    label = "Site 2, Serial # S9059",
    labelOptions = labelOptions(noHide = F, direction= "right"),
    popup= '<a href = "http://rpubs.com/melimore86/site2measurements"> Sensor Measurements </a>',icon=staricon) %>%
  addMarkers(
    lng = -83.090120041742921, lat = 29.231049958616495,
    label = "Site 3, Serial # V6916",
    labelOptions = labelOptions(noHide = F, direction= "bottom"),
    popup= '<a href = "http://rpubs.com/melimore86/site3measurements"> Sensor Measurements </a>',icon=divericon) %>%
  addMarkers(
    lng = -83.092115018516779, lat = 29.230171032249928,
    label = "Site 4, Serial # S9058",
    labelOptions = labelOptions(noHide = F, direction= "left"),
    popup= '<a href = "http://rpubs.com/melimore86/site4measurements"> Sensor Measurements </a>',icon=staricon) %>%
  addMarkers(
    lng = -83.101499984040856, lat = 29.246092038229108,
    label = "Site 5, Serial # S9060",
    labelOptions = labelOptions(noHide = F, direction= "left"),
    popup= '<a href = "http://rpubs.com/melimore86/site5measurements"> Sensor Measurements </a>',icon=staricon) %>%
  addMarkers(
    lng = -83.118119034916162, lat = 29.265770986676216,
    label = "Site 6, Serial # S9061",
    labelOptions = labelOptions(noHide = F, direction= "left"),
    popup= '<a href = "http://rpubs.com/melimore86/site6measurements"> Sensor Measurements </a>',icon=staricon)%>%
  addMarkers(
    lng = -83.098221989348531, lat = 29.267726987600327,
    label = "Site 7, Serial # S9035 ",
    labelOptions = labelOptions(noHide = F, direction= "top"),
    popup= '<a href = "http://rpubs.com/melimore86/site7measurements"> Sensor Measurements </a>',icon=staricon) %>%
  addMarkers(
    lng = -83.080270970240235, lat = 29.257425041869283,
    label = "Site 8, Serial # S9062",
    labelOptions = labelOptions(noHide = F, direction= "top"),
    popup= '<a href = "http://rpubs.com/melimore86/site8measurements"> Sensor Measurements </a>',icon=staricon) %>%
  addMarkers(
    lng = -83.082710020244122, lat = 29.232152011245489,
    label = "Site 9, Serial # S9036",
    labelOptions = labelOptions(noHide = F, direction= "top"),
    popup= '<a href = "http://rpubs.com/melimore86/site9measurements"> Sensor Measurements </a>',icon=staricon) %>%
  addProviderTiles("OpenWeatherMap.Clouds", group = "clouds2", options = tileOptions(opacity = 0.6)) %>%
  addTiles(urlTemplate = "http://{s}.tile.openweathermap.org/map/temp/{z}/{x}/{y}.png", attribution = "Weather data © OpenWeatherMap", group = "temp", options = tileOptions(opacity = 0.6)) %>% 
  addTiles(urlTemplate = "http://{s}.tile.openweathermap.org/map/precipitation/{z}/{x}/{y}.png", attribution = "Weather data © OpenWeatherMap", group = "precipitation", 
           options = tileOptions(opacity = 0.6)) %>% addTiles(urlTemplate = "http://{s}.tile.openweathermap.org/map/snow/{z}/{x}/{y}.png", attribution = "Weather data © OpenWeatherMap", group = "snow", options = tileOptions(opacity = 0.6)) %>% 
  addTiles(urlTemplate = "http://{s}.tile.openweathermap.org/map/wind/{z}/{x}/{y}.png", 
           attribution = "Weather data © OpenWeatherMap", group = "wind", 
           options = tileOptions(opacity = 0.6)) %>% 
  addLayersControl(baseGroups = c("OpenStreetMap.HOT","Esri.NatGeoWorldMap","Esri WorldImagery"), overlayGroups = c("1982 oyster distribution","1995 oyster distribution","2001 oyster distribution","2010 oyster distribution","Proposed Reef"), options = layersControlOptions(collapsed = TRUE)) %>% 
  hideGroup(c("2010 oyster distribution","2001 oyster distribution","1995 oyster distribution","1982 oyster distribution","Proposed Reef"))

```

[Salinity Figures - Sites 1-9](http://rpubs.com/melimore86/allsalplots)  
[Discrete Lab Results- Sites 1-6 ](http://rpubs.com/melimore86/alllabresults)  
[Shiny App](https://oysterprojectck.shinyapps.io/mels-shiny/)

```{r intermap, echo=FALSE}
intermap
```



